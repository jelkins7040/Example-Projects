/*!
 * (c) 2010 SysIQ, Inc. All rights reserved.
 *
 * This product is protected by United States laws,
 * international copyright treaties and all other applicable
 * national or international laws.
 *
 * This software may not, in whole or in part, be copied,
 * photocopied, translated, modified, or reduced to any
 * electronic medium or machine readable form
 * without the prior written consent of SysIQ, Inc.
 *
 * Filename: jquery.productPersonalization.js
 * Author:   Dmitry Shestopalov
 */
(function(a){var b={selectors:{variationsSelect:"select[name$='VariationProductUUID']",variationItem:".variationitem"}};a.fn.productVariation=function(q){var d=a.extend({},b,q);var h=this.mapSelectors(d.selectors);var p=a(this);function n(w,s,u,o){for(x in s){if(x==0){var v=s[x];var t=i(w,v);var r=e(u,o,v);k(w,v,t,false,r)}else{var v=s[x];var t=i(w,v);var r=e(u,o,v);k(w,v,t,true,r)}}if(o!=""){j(w,s,u)}}function k(u,t,o,s,r){p.find("select[id='"+t+"'][name='"+u+"_VariationProductUUID']").each(function(v,w){if(o.length>0){a(this).find("option").remove();a(this).append("<option "+((r)?"":'selected="selected"')+' value="">Select Option</option>');for(x in o){a(this).append("<option "+((r==o[x])?'selected="selected"':"")+' value="'+o[x]+'">'+o[x]+"</option>")}}if(s){if(!r){a(this).attr("disabled",true)}else{a(this).removeAttr("disabled")}}else{a(this).removeAttr("disabled")}})}function e(s,o,t){if(!o||o.length==0){return false}var r;a.each(s,function(w,u){if(u.value==o){r=u.key[t]}});return r}function m(v,u,s,o){var r={};var t=[];a.each(v,function(y,w){if(w.key[u]==s){if(!r[w.key[o]]&&w.key[o].length>0){r[w.key[o]]=true;t.push(w.key[o])}}});return t}function i(t,o){var r={};var s=[];a("#"+t+".productitem").find("#"+o+" option").each(function(){var u=a(this).val();if(!r[u]&&u!=null&&u.length!=null&&(u.length>0)){r[u]=true;s.push(u)}});return s}function g(t,s){var o={};var r=[];a.each(t,function(w,u){if(!o[u.key[s]]&&u.key[s]!=null&&u.key[s].length!=null&&(u.key[s].length>0)){o[u.key[s]]=true;r.push(u.key[s])}});return r}function l(v,t,u){var s=false;p.find("p[id='"+v+"_stockstatus'] .defaultstatus").show();p.find("p[id='"+v+"_stockstatus'] .variationstatus").html("").hide();p.find("div[id='"+v+"_pricesection'] .defaultprice").show();p.find("div[id='"+v+"_pricesection'] .variationprice").hide();var o=p.find("p[id='"+v+"_stockstatus']").parents("form").find("input.addtocartbutton");if(o.is(":disabled")){o.removeClass("addtobag-disable").addClass("addtobag").removeAttr("disabled")}p.find("input[name='"+v+"_SelectedVProductUUID']").val("");var r=[];for(x in t){if(s){k(v,t[x],r,true)}if(t[x]==u){s=true}}}function c(r,s){var o=null;for(x in r){if(r[x]==s){o=r[++x]}}return o}function j(v,t,u){var r={};var o="";for(x in t){var s=p.find("select[id='"+t[x]+"'][name='"+v+"_VariationProductUUID']").val();if(s.length>0){r[t[x]]=s}}a.each(u,function(z,y){var A=0;for(x in t){if(y.key[t[x]]==r[t[x]]){A++}}if(A==t.length){o=y.value;p.find("input[name='"+v+"_SelectedVProductUUID']").val(y.value);p.find("p[id='"+v+"_stockstatus'] .defaultstatus").hide();p.find('.productitem[id="'+v+'"]').find("[class$='productAttr']").hide().end().find("."+o+"_productAttr").show();var B;if(y.pricewas.length>0){B=a("<span class='feat_price_over'>Was: "+y.pricewas+"</span>&nbsp;&nbsp;<b class='now_red_price'>Now: "+y.pricenow+"</b>")}else{B=y.pricenow}p.find("div[id='"+v+"_pricesection'] .defaultprice").hide();p.find("div[id='"+v+"_pricesection'] .variationprice").html(B).show();var w=p.find("p[id='"+v+"_stockstatus']").parents("form").find("input.addtocartbutton");if(y.show){if(w.is(":disabled")){w.removeClass("addtobag-disable").addClass("addtobag").removeAttr("disabled")}}else{if(!w.is(":disabled")){w.removeClass("addtobag").addClass("addtobag-disable").attr("disabled","disabled")}}}});return o}function f(o){return o in window?window[o]:""}h.variationsSelect.change(function(){var A=a(this).val();var v=a(this).attr("id");var w=a(this).attr("name").replace("_VariationProductUUID","");var o=f(w+"_keys");var B=f(w+"_variations");if(A.length>0){var z=c(o,v);if(z!=undefined){l(w,o,z);var t=m(B,v,A,z);k(w,z,t)}else{j(w,o,B)}}else{var u=a.inArray(v,o);if(u>-1){for(var s=u+1;s<o.length;s++){p.find("select[id='"+o[s]+"'][name='"+w+"_VariationProductUUID']").each(function(){this.selectedIndex=0})}}l(w,o,v);p.find('.productitem[id="'+w+'"]').find("[class$='productAttr']").hide().end().find(".productAttr").show();var y=f(w);var r=p.find("div[id='"+w+"']").parents("form").find("input.addtocartbutton");if(y.show){if(r.is(":disabled")){r.removeClass("addtobag-disable").addClass("addtobag").removeAttr("disabled")}}else{if(!r.is(":disabled")){r.removeClass("addtobag").addClass("addtobag-disable").attr("disabled","disabled")}}}});h.variationItem.click(function(u){u.preventDefault();var t=a(this).attr("vproductid").split(",");var o=t[0];var r=t[1];var s=t[2];var v=f(o+"_variations");a.each(v,function(z,y){if(y.value==r){if(y.key[s].length>0){var w=a("select[id='"+s+"'][name='"+o+"_VariationProductUUID']");if(!w.is(":disabled")){w.val(y.key[s]).trigger("change")}}}})});h.variationsSelect.each(function(){var t=a(this).val();var r=a(this).attr("id");var w=a(this).attr("name").replace("_VariationProductUUID","");var s=f(w+"_keys");var v=f(w+"_variations");var o;try{o=f(w+"_selectedProduct")}catch(u){o=""}setTimeout(function(){n(w,s,v,o)},1000)})}})(jQuery);