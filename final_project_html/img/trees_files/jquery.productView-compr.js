/*!
 * (c) 2010 SysIQ, Inc. All rights reserved.
 *
 * This product is protected by United States laws,
 * international copyright treaties and all other applicable
 * national or international laws.
 *
 * This software may not, in whole or in part, be copied,
 * photocopied, translated, modified, or reduced to any
 * electronic medium or machine readable form
 * without the prior written consent of SysIQ, Inc.
 *
 * Filename: jquery.productView.js
 * Author:   Dmitry Shestopalov
 */
function showLargerViewPopup(){$("#ViewLargerPopup").trigger("showPopup")}function cmPageView(a,c){var b=$("#cmxEnabled").val();if(b){cmCreatePageviewTag(a,c)}}(function(a){a.property("validatePersonalizationAttr");var b={prodSku:null,prodUuid:null,trueSpectraHost:"trueSpectraHost",scene7host:"scene7host",webRoot:"WebRoot",qv:false,loggedIn:false,addToWishListFlag:false,addToNotificationFlag:false,invalidCredentialFlag:false,urls:{checkUserUrl:"",addWishListUrl:"",addWishListFromSessionUrl:"",formSaveUrl:"",addNotificationUrl:"",getColor:""},selectors:{persCheckBox:":checkbox#personalization",variationsSelects:"input[name$='_VariationProductUUID']",selectedVariations:"input[name$='_SelectedVProductUUID']",form:"form[name='addToReq']",addToWishListLink:"#addToWishlist",shareLink:".addthis_button_compact",addNotificationLink:"#addNotificarion",emailToFriend:".emailToFriend",emailToFriendSI:".social-icon.email",facebookSI:".social-icon.facebook",twitterSI:".social-icon.twitter",pinterestSI:".social-icon.pinterest",emailToFriendForm:"form[name=EmailToFriend]",shippingInfoLink:"#shippinginfolink, .shippinginfolink",back:"#back",addToCartBtn:".addtocartbutton"},popUps:{loginWishListPopup:"#loginWishListPopup",loginNotificationPopup:"#loginNotificationPopup",emailToFriendPopup:"#EmailToFriendPopup",shippingInfoPopup:"#ShippingInfoPopup"}};a.fn.productView=function(g){var u=a.extend({},b,g);var h=this.mapSelectors(u.selectors);var k=this.mapSelectors(u.popUps);var t=a(this).find(".prodinfo");function v(y,z,x){var o=new S7GumpsZoom();o.setSKU(y);o.setDiv(document.getElementById(z));o.setConfig(x);o.draw()}function w(y,x){var o=new S7GumpsZoom();o.setSKU(y);o.setDiv(document.getElementById("ViewLargerPopupInner"));o.setConfig(x);o.draw()}function q(z,A,y){var o=a(document.getElementById(A)),x=a("<img>").attr("src",u.scene7host+"/"+z+"?$"+y+"$");o.append(x);if(/iPad/.test(navigator.userAgent)){a("<a>",{href:"#",text:"More images >"}).appendTo(o).add(x).click(function(B){window.open("http://gumps.scene7.com/s7viewers/html5/genericZoomMobile.html?serverUrl=http://gumps.scene7.com/is/image/&config=Scene7SharedAssets/ImageSet%5FHTML5&contentRoot=http://gumps.scene7.com/skins/&asset=Gumps/"+z);B.preventDefault()})}}function n(o){o.validate({validClass:"inputValid",onfocusout:false,onkeyup:false,errorClass:"inputError",showErrors:function(A,B){a("form[name=EmailToFriend] input[type=text], form[name=EmailToFriend] label").removeClass("inputError");var C=new Array();var z=a(this.currentForm);a(B).each(function(){var D=a(this.element).attr("id");a(this.element).addClass("inputError");z.find("div.errormessage").html(this.message);z.find("label[for="+D+"]").addClass("inputError");C.push(this.message)});function y(G){var D=new Array();label:for(var F=0;F<G.length;F++){for(var E=0;E<D.length;E++){if(D[E]==G[F]){continue label}}D[D.length]=G[F]}return D}var x=y(C);a("form[name=EmailToFriend] div.errormessage").html(x.join("<br />"))},rules:{EmailToFriend_sendEmailSenderName:{required:true},EmailToFriend_sendEmailSenderEmail:{required:true,email:true},EmailToFriend_sendEmailRecipientEmail1:{required:true,email:true},EmailToFriend_sendEmailRecipientEmail2:{email:true},EmailToFriend_sendEmailRecipientEmail3:{email:true}},messages:{EmailToFriend_sendEmailSenderName:{required:"Please fill in the required fields highlighted in red below."},EmailToFriend_sendEmailSenderEmail:{required:"Please fill in the required fields highlighted in red below.",email:"Please enter a valid email address in the format of name@domain.com. Email addresses cannot contain special symbolssuch as '!', '$', and/or '/'."},EmailToFriend_sendEmailRecipientEmail1:{required:"Please fill in the required fields highlighted in red below.",email:"Please enter a valid email address in the format of name@domain.com. Email addresses cannot contain special symbolssuch as '!', '$', and/or '/'."},EmailToFriend_sendEmailRecipientEmail2:{email:"Please enter a valid email address in the format of name@domain.com. Email addresses cannot contain special symbolssuch as '!', '$', and/or '/'."},EmailToFriend_sendEmailRecipientEmail3:{email:"Please enter a valid email address in the format of name@domain.com. Email addresses cannot contain special symbolssuch as '!', '$', and/or '/'."}},submitHandler:function(A){var z=a(A).serialize();var x=a(A).attr("action");var y=this.submitButton;y.disabled=true;a.getJSON(x,z,function(B){if(B.success==true){r(B.message)}else{alert(B.success)}y.disabled=false})}})}function f(){a("form[name=EmailToFriend] label, form[name=EmailToFriend] input").removeClass("inputError");a("form[name=EmailToFriend] input").not("[type=submit]").not("[type=hidden]").val("");a("form[name=EmailToFriend] textarea").val("");a("form[name=EmailToFriend]")[0].reset();a(".sendFriendForm").show();a(".sendFriendSuccess").hide()}function l(){j();s()}function s(){var o=t.find("input[name$=_Quantity],select[name$=_Quantity]").not(":hidden");var x=t.find("input.addtocartbutton:visible");if(o.length==0&&x.length>0&&!x.is(":disabled")){x.removeClass("addtobag").addClass("addtobag-disable").attr("disabled","disabled")}else{if(o.length==0&&x.length>0){x.removeClass("disabledFirst")}}}function j(){if(t.find(".attrgroupitems .attrgroupitem").length>3){t.find(".attrgroupitems .attrgroupitem").filter(function(o){return o>0}).hide()}h.selectedVariations.each(function(o,x){a(this).val("")})}function r(o){if(o.length>0){a("div[id$='Popup']").trigger("closePopup");a("#messengerPopupInner").html(o);a("#messengerPopup").trigger("showPopup")}}function i(o){var x=true;h.persCheckBox.each(function(z,B){var y=a(this).closest(".prodinfo");if(m()){var A=a(this).val();y.find("*[name^='"+A+"']").each(function(C,E){a(this).removeClass("inputError");if(a(this).val().length<=0){var D=true;a(this).closest("#personalizationbody").find("input[type=text]").each(function(){if(a(this).val().length!=0){D=false}});if((a(this).is("input[type=text]")&&D)||!a(this).is("input[type=text]")){a(this).addClass("inputError");if(o){y.find("p.errorpersonalizationymessagewl."+A+"").show()}else{y.find("p.errorpersonalizationymessage."+A+"").show()}x=false;if(u.qv){y.find(".tabs").tabs("option","selected",1)}}}})}});return x}this.propertyHandler("validatePersonalizationAttr",{get:function(o){return i()}});function m(){var o=false;h.persCheckBox.each(function(x,z){if(a(this).is(":checked")){o=true}else{var y=a(this).val();t.find("*[name^='"+y+"']").each(function(A,B){if(a(this).val().length>0){o=true}})}});return o}function e(x){var o=true;h.selectedVariations.filter(function(y){return(a(this).val().length>0)}).each(function(B,C){var A=a(this).attr("name").replace("_SelectedVProductUUID","");var y=t.find("input[name='"+A+"_Quantity'],select[name='"+A+"_Quantity']").not(":hidden");if(y.length>0&&((y.val()<=0&&!x)||y.val()==""||isNaN(y.val()*1))){var z=y.attr("name").replace("_Quantity","");a(y).addClass("errorfield");t.find("p.errorquantitymessage."+z+"").show();o=false}});return o}function p(A,y){var x=true;var z=A.find("input[name='SelectedProductsUUID']");if(z.length==1){x=d(z.val(),y)}else{var o=true;z.each(function(){var C=a(this).val();var B=A.find("input[name='"+C+"_Quantity'],select[name='"+C+"_Quantity']");if(!(B.val()==0||B.val()=="")){o=false;x=d(C,y)}});if(o){x=d(z.eq(0).val(),y)}}return x}function d(o,z){var y=true;t.find("select[name='"+o+"_VariationProductUUID']").each(function(A,B){if(a(this).val().length==0&&!a(this).is(":disabled")){a(this).addClass("errorfield");t.find("p.errorselectmessage."+o+"").show();y=false}});var x=t.find("input[name$='"+o+"_Quantity'],select[name$='"+o+"_Quantity']").not(":hidden");if(x.length>0&&((x.val()<=0&&!z)||x.val()==""||isNaN(x.val()*1))){a(x).addClass("errorfield");t.find("p.errorquantitymessage."+o+"").show();y=false}return y}function c(){var o=true;t.find("input[name$='_Quantity'],select[name$='_Quantity']").each(function(y,A){var x=a(this).val();var z=parseInt(x);if(x==""||x.length<=0||isNaN(z)||!(x.length==(z+"").length)){a(this).addClass("errorfield");o=false}});return o}if(hasFlash){v(u.prodSku+"_is",u.prodUuid,(u.qv?"QV_Gumps":"PDP_Gumps"));w(u.prodSku+"_is","ViewLarger")}else{q(u.prodSku+"_is",u.prodUuid,(u.qv?"QV_Main":"PIP_Main"))}l();a(".hidePopup").click(function(){f()});t.find(".tabs").tabs({selected:0,show:function(o,x){}});t.find("div[id^='tabs-1-'], div[id^='tabs-2-'], div[id^='tabs-3-']").show();h.addToWishListLink.click(function(y){y.preventDefault();if(!c()){return false}else{t.find(".errorquantitymessage").hide()}var z=a(this).parents("#product_info");var o=z.find(u.selectors.selectedVariations);var x=true;if(o.length>0){o.filter(function(A){return(a(this).val().length<=0)}).each(function(A,B){r("Please select the product option(s) you wish to add to your wish list.");x=false;return})}if(x&&i("wl")){setPersonalizationData();a.ajax({url:u.urls.checkUserUrl,dataType:"json",success:function(A){if(A.success){a("body").addWishListFn(h.form.filter(":visible"))}else{a("div[id$='Popup']:visible").trigger("closePopup");a("body").saveFormValuesToSession(h.form.filter(":visible"));k.loginWishListPopup.trigger("showPopup");cmPageView("POPUP: Login on PIP","My-Account")}},error:function(C,B,A){alert("Error: request exception, "+C+", "+B+", "+A)}})}});h.shareLink.click(function(o){cmPageView("POPUP: Share (Social Media) on PIP","Social")});h.addNotificationLink.click(function(o){o.preventDefault();a.ajax({url:u.urls.checkUserUrl,dataType:"json",success:function(x){if(x.success){a("body").addToNotification(a(o.target).parent().find("[name='SelectedProductUUID']"))}else{a("div[id$='Popup']").trigger("closePopup");a("body").find("[value='mock']").attr("value",a(o.target).parent().find("[name='SelectedProductUUID']").val());k.loginNotificationPopup.trigger("showPopup")}},error:function(z,y,x){alert("Error: request exception, "+z+", "+y+", "+x)}})});h.emailToFriend.click(function(y){y.preventDefault();h.emailToFriendForm.find("div.inputError").html("");var x=k.emailToFriendPopup;var z=x.clone(true);z.addClass("toDelete").appendTo("body");z.find(".popup-overlay").css({"z-index":1002});var o=z.find("form");o.find("label").each(function(){var A=a(this).attr("for");a(this).attr("for",A+"_etf");a(this).siblings("#"+A).attr("id",A+"_etf")});n(o);z.gumpsPopup();z.trigger("showPopup");cmPageView("POPUP: Email to a Friend on PIP","Social");return false});h.emailToFriendSI.click(function(y){y.preventDefault();h.emailToFriendForm.find("div.inputError").html("");var x=k.emailToFriendPopup;if(a("a.social-icon.email").closest("div#QuickViewPIPPopupInner").length>0){var z=x.clone(true);z.addClass("toDelete").appendTo("body");z.find(".popup-overlay").css({"z-index":1002});var o=z.find("form");o.find("label").each(function(){var A=a(this).attr("for");a(this).attr("for",A+"_etf");a(this).siblings("#"+A).attr("id",A+"_etf")});n(o);z.gumpsPopup();z.trigger("showPopup")}else{x.find(".popup-overlay").css({"z-index":1002});var o=x.find("form");o.find("label").each(function(){var A=a(this).attr("for");a(this).attr("for",A+"_etf");a(this).siblings("#"+A).attr("id",A+"_etf")});n(o);x.trigger("showPopup")}cmPageView("POPUP: Email to a Friend on PIP","Social");return false});h.facebookSI.click(function(y){y.preventDefault();cmCreateElementTag("Facebook","Social Media");var o=a(this).closest(".share-it").attr("prname");var x=a(this).closest(".prodinfo-box").find(".more-details-link").attr("href");if(!x){x=location.href}window.open("http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(x)+"&utm_medium=referral&utm_campaign=share_product&utm_keyword="+encodeURIComponent(o)+"&t="+encodeURIComponent(o),"mywindow","width=800,height=400,scrollbars=yes");return false});h.twitterSI.click(function(y){y.preventDefault();cmCreateElementTag("Twitter","Social Media");var o=a(this).closest(".share-it").attr("prname");var x=a(this).closest(".prodinfo-box").find(".more-details-link").attr("href");if(!x){x=location.href}window.open("https://twitter.com/intent/tweet?original_referer="+encodeURIComponent(x)+"&related=GUMPS&text=I%27m+exceptionally+fond+of%3A+"+encodeURIComponent(o)+"+"+encodeURIComponent(x)+"&url=","mywindow","width=800,height=400,scrollbars=yes");return false});h.pinterestSI.click(function(z){z.preventDefault();cmCreateElementTag("Pinterest","Social Media");var o=a(this).closest(".share-it").attr("prname");var x=a(this).closest(".share-it").attr("img");var y=a(this).closest(".prodinfo-box").find(".more-details-link").attr("href");if(!y){y=location.href}window.open("http://pinterest.com/pin/create/button/?url="+encodeURIComponent(y)+"&media="+encodeURIComponent(x)+"&description="+encodeURIComponent(o),"mywindow","width=800,height=400,scrollbars=yes");return false});h.shippingInfoLink.click(function(o){o.preventDefault();a("div[id$='Popup']").trigger("closePopup");k.shippingInfoPopup.trigger("showPopup",["#'#'#ShippingInfoPopupInner>.content-box"]);cmPageView("POPUP: Shipping information on PIP","Shipping Information");return false});h.back.click(function(x){x.preventDefault();var o=a("#lastcat");var y=a("#homecat");if(o.length>0){window.location=o.attr("href")}else{if(y.length>0){window.location=y.attr("href")}}});h.addToCartBtn.each(function(){if(a(this).hasClass("disabledFirst")){a(this).removeClass("disabledFirst").removeClass("addtobag-disable").removeAttr("disabled")}});h.addToCartBtn.click(function(A){var z=a(this);var y=z.hasClass("btn-update");var B=z.parents("#product_info");if(B.length==0){B=z.parents("#alternative_product_info")}A.preventDefault();if(z.is(":disabled")){return}var x=true;t.find("input").removeClass("inputError");t.find(".errorpersonalizationymessage, .errorpersonalizationymessagewl, .errorquantitymessage, .errorselectmessage").hide();if(!c(y)){x=false}if(!e(y)){x=false}if(!p(B,y)){x=false}if(!i()){x=false}if(x){if(m()){setPersonalizationData()}z.trigger("addtocart",[function(){a("select[name=state]").trigger("change")}]);if(u.qv){var o=z.closest("#QuickViewPIPPopup");o.trigger("closePopup")}}return false});a(this).productPersonalization({trueSpectraHost:u.trueSpectraHost,webRoot:u.webRoot,qv:u.qv,urls:u.urls});a(this).productVariation({variationsSelects:h.variationsSelects,qv:u.qv})}})(jQuery);