/*!
 * (c) 2010 SysIQ, Inc. All rights reserved.
 *
 * This product is protected by United States laws,
 * international copyright treaties and all other applicable
 * national or international laws.
 *
 * This software may not, in whole or in part, be copied,
 * photocopied, translated, modified, or reduced to any
 * electronic medium or machine readable form
 * without the prior written consent of SysIQ, Inc.
 *
 * Filename: jquery.commonStart.js
 * Author:   Dmitry Shestopalov
 */
$.property("saveFormValuesToSession");$.property("addToNotification");$.property("addWishListFn");$.property("loggedIn");$.eventShortcut("itemAddedToWishList");var hasFlash=false,flashVersion="",qvAjaxActive=false;(function(){function a(g){var e=g.match(/[\d]+/g);e.length=3;return e.join(".")}if(navigator.plugins&&navigator.plugins.length){var b=navigator.plugins["Shockwave Flash"];if(b){hasFlash=true;if(b.description){flashVersion=a(b.description)}}if(navigator.plugins["Shockwave Flash 2.0"]){hasFlash=true;flashVersion="2.0.0.11"}}else{if(navigator.mimeTypes&&navigator.mimeTypes.length){var f=navigator.mimeTypes["application/x-shockwave-flash"];hasFlash=f&&f.enabledPlugin;if(hasFlash){flashVersion=a(f.enabledPlugin.description)}}else{try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");hasFlash=true;flashVersion=a(c.GetVariable("$version"))}catch(d){try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");hasFlash=true;flashVersion="6.0.21"}catch(d){try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");hasFlash=true;flashVersion=a(c.GetVariable("$version"))}catch(d){}}}}}})();(function(a){var b={prodSku:null,prodUuid:null,qv:false,loggedIn:false,addToWishListFlag:false,addToNotificationFlag:false,invalidCredentialFlag:false,startCheckout:false,isProduction:false,urls:{checkUserUrl:"",addWishListUrl:"",addWishListFromSessionUrl:"",formSaveUrl:"",addNotificationUrl:"",productInformationUrl:""},selectors:{form:"form[name='addToReq'], form[name='CurrentReq']",addToWishListLink:"#addToWishlist",addNotificationLink:"#addNotificarion"},popUps:{loginWishListPopup:"#loginWishListPopup",loginNotificationPopup:"#loginNotificationPopup",loginCheckoutPopup:"#loginCheckoutPopup"}};if(/iPhone|iPad/.test(navigator.userAgent)){jQuery.fn.oneFingerScroll=function(c){var e=this,d=0,f=/OS\s+(\d+)/.test(navigator.userAgent)&&RegExp.$1>4;if(f&&false){if(c){e.css("-webkit-overflow-scrolling","auto")}else{e.css("-webkit-overflow-scrolling","touch").trigger("focus")}}else{e.unbind(".touchScroll");if(c){e.bind("touchmove.touchScroll",function(g){if(g.originalEvent.touches.length<2){g.preventDefault()}})}else{e.bind("touchstart.touchScroll",function(h){var g=a(h.target);if(!g.is("a, input")&&!g.closest(".gumpsControl").length){var i=h.originalEvent;d=a(this).scrollTop()+i.touches[0].pageY}});e.bind("touchmove.touchScroll",function(g){var h=g.originalEvent;if(h.touches.length<2){a(this).scrollTop(d-h.touches[0].pageY);g.preventDefault()}})}}return this}}a.fn.commonFunctions=function(m){var c=a.extend({},b,m);var l=a(this);var d=l.mapSelectors(c.selectors);var k=l.mapSelectors(c.popUps);function f(n){if(!n){n=d.form.filter(":visible")}a.ajax({url:c.urls.addWishListUrl,data:a(n).serialize(),dataType:"json",success:function(o){h(o.message);l.itemAddedToWishList();if(window.cmPageViewPageID=="ShoppingBag"){a("#messengerPopup input#closepopup.button").click(function(){if(a("body").pageState().data.requisition.lineItemCount==0){n&&n.emptyBagURL&&(window.location=n.emptyBagURL)}})}},error:function(q,p,o){alert("Error: request exception, "+q+", "+p+", "+o)}})}this.propertyHandler("addWishListFn",{set:function(o,n){f(o,n)}});function j(o){var n=true;if(!o){o=d.form.filter(":visible")}a.ajax({url:c.urls.formSaveUrl,data:a(o).serialize(),dataType:"json",success:function(p){if(p.success){n=true}else{h(p.message);n=false}},error:function(r,q,p){n=false}});return n}this.propertyHandler("saveFormValuesToSession",{set:function(o,n){j(o)}});function i(n){var n=(n)?false:true;a.ajax({url:c.urls.addWishListFromSessionUrl,dataType:"json",success:function(o){h(o.message)},error:function(q,p,o){alert("Error: request exception, "+q+", "+p+", "+o)},async:n})}function g(n){a.ajax({url:c.urls.addNotificationUrl,data:"SelectedProductUUID="+a(n).val(),dataType:"json",success:function(o){h(o.message)},error:function(q,p,o){alert("Error: request exception, "+q+", "+p+", "+o)}})}this.propertyHandler("addToNotification",{set:function(n){g(n)}});function h(n){if(n.length>0){a("div[id$='Popup']:visible").trigger("closePopup");a("#messengerPopupInner").html(n);a("#messengerPopup").trigger("showPopup")}}this.propertyHandler("loggedIn",{get:function(){return c.loggedIn}});if(c.addToWishListFlag&&c.loggedIn){i("sync")}if(c.addToNotificationFlag&&c.loggedIn){g(a("body").find("[name='UsedUUIDForNotification']"))}if(c.invalidCredentialFlag){if(c.addToWishListFlag){k.loginWishListPopup.find(".errormessage").html("We’re sorry, no such account with that email address can be found.");k.loginWishListPopup.trigger("showPopup");k.loginWishListPopup.find("label[for=LoginForm_Login], label[for=LoginForm_Password]").addClass("inputError")}if(c.addToNotificationFlag){k.loginNotificationPopup.find(".errormessage").html("We’re sorry, no such account with that email address can be found.");k.loginNotificationPopup.trigger("showPopup");k.loginNotificationPopup.find("label[for=LoginForm_Login], label[for=LoginForm_Password]").addClass("inputError")}if(c.startCheckout){k.loginCheckoutPopup.find(".errormessage").html("We’re sorry, no such account with that email address can be found.");k.loginCheckoutPopup.trigger("showPopup");k.loginCheckoutPopup.find("label[for=LoginForm_Login], label[for=LoginForm_Password]").addClass("inputError")}}function e(q,p,s){var r="save";var o=null;if(q.indexOf("##")!=-1){var n=q.split("##");o=n[1];q=n[0];r=null}if(q){window.cm_vc=q}a.ajax({url:c.urls.productInformationUrl,type:"POST",data:{ProductUUID:p,CatalogCategoryID:s,cm_vc:q,mode:r,plid:o},dataType:"json",success:function(v){var u=null;for(var t=0;t<v.products.length;t++){u=v.products[t];if(q=="Search"&&q==u.CategoryID){q=""}if(o){q=""}if(typeof cmCreateProductviewTag=="function"){cmCreateProductviewTag(u.ProductID,u.ProductName,u.CategoryID,"",q)}}},error:function(t){4}})}if(!navigator.userAgent.match(/iPad/gi)){a(".image").hover(function(n){a(this).find(".quickview").show()},function(){if(!a(this).find(".quickvh").hasClass("ajaxloadingqv")){a(this).find(".quickview").hide()}})}a(".quickvh, .editLineItem").live("click",function(s){s.preventDefault();if(qvAjaxActive){return false}var n=a(this);n.addClass("ajaxloadingqv");qvAjaxActive=true;var p=a(this).attr("href");var r=p.split("&");var o=null;for(var q=0;q<r.length;q++){if(r[q].indexOf("LineItemID")!=-1){o=r[q].split("=")[1]}}a.ajax({url:p,type:"POST",success:function(t){a("div[id$='Popup']:visible").trigger("closePopup");a("#QuickViewPIPPopupInner").html("").html(t);a("#QuickViewPIPPopup").trigger("showPopup");n.removeClass("ajaxloadingqv").closest(".quickview").hide();n.removeClass("ajaxloadingqv");qvAjaxActive=false;if(window.cmxEnabled){var y=a("#QuickViewPIPPopupInner").find("#cmPageID").val();if(y){var w=a("#QuickViewPIPPopupInner").find("#cmCategoryID").val();var v=a("#QuickViewPIPPopupInner").find("#cmProductID").val();if(window.cmPageViewPageID=="PIP"){if(n.is(".RecentlyViewed")){window.cmSendPageViewTag(y,"RecentlyViewed-PIP","put",true)}else{if(n.is(".Cross-Sell")){window.cmSendPageViewTag(y,"Cross-Sell-PIP","put",true)}}}else{if(window.cmPageViewPageID=="ShoppingBag"){if(n.is(".RecentlyViewed")){window.cmSendPageViewTag(y,"RecentlyViewed-ShopBag","put",true)}else{if(n.is(".Cross-Sell")){window.cmSendPageViewTag(y,"Cross-Sell-ShopBag","put",true)}else{if(n.is(".shoppingbagpageclass")){window.cmSendPageViewTag(y,"Shopping-Bag","get",true)}}}}else{if(window.cmPageViewPageID=="My-Account"||window.cmPageViewPageID=="Public-Wishlist"){window.cmSendPageViewTag(y,window.cmPageViewPageID,"put",true)}else{if(window.cmPageViewPageID=="Search"){window.cmSendPageViewTag(y,"Search","put",true)}else{if(n.is(".checkoutpageclass")){window.cmSendPageViewTag(y,"Checkout","get",true)}else{window.cmSendPageViewTag(y,w,"put",true)}}}}}if(window.cmPageViewPageID=="PIP"){if(n.is(".RecentlyViewed")){e("RecentlyViewed-PIP",v,w)}else{if(n.is(".Cross-Sell")){e("Cross-Sell-PIP",v,w)}}}else{if(window.cmPageViewPageID=="ShoppingBag"){if(n.is(".RecentlyViewed")){e("RecentlyViewed-ShopBag",v,w)}else{if(n.is(".Cross-Sell")){e("Cross-Sell-ShopBag",v,w)}else{if(n.is(".shoppingbagpageclass")){e("Shopping-Bag##"+o,v,w)}}}}else{if(window.cmPageViewPageID=="My-Account"||window.cmPageViewPageID=="Public-Wishlist"){e(window.cmPageViewPageID,v,w)}else{if(window.cmPageViewPageID=="Search"){e("Search",v,w)}else{if(n.is(".checkoutpageclass")){e("Checkout##"+o,v,w)}else{if(window.cmPageViewPageID=="OrderConfirm"){e("Cross-Sell-OrderConfirm",v,w)}else{e("",v,w)}}}}}}}}if(n.hasClass("quickvh")&&c.isProduction){var u=a("#QuickViewPIPPopupInner").find("#productShortName").val()||"unknown-product";var x=window._gaq||[];x.push(["_setAccount","UA-7744346-1"]);x.push(["_trackPageview","/qv/"+u])}return false},error:function(v,u,t){alert("Error: request exception, "+v+", "+u+", "+t);n.removeClass("ajaxloadingqv");qvAjaxActive=false}});return false});a(".papShippingInfo").live("click",function(){a("div[id$='Popup']").trigger("closePopup");a("#ShippingInfoPopup").trigger("showPopup");return false});a(".prodalerts-box .addToReq").submit(function(){a(this).find(".addtocartbutton").trigger("addtocart");return false});a(".removenotification").bind("click",function(o){var n=a(this).parent("form");a("#confirmPopup").messageBox(function(q,p){switch(q){case"OK":n.submit();p();break;case"CANCEL":p();break;default:}},{message:"This notification will be removed.  Do you wish to continue?",showFn:function(){this.trigger("showPopup");cmCreatePageviewTag("POPUP: Removing Item from Product Alert","My-Account")}})});a('a[href*=";pgid="]').each(function(){var o=a(this).attr("href");var n=o.substr(0,o.indexOf(";pgid=")).concat(o.substr((o.indexOf(";pgid=")+42),(o.length-1)));a(this).attr("href",n)});a('a[href*=";sid="]').each(function(){var o=a(this).attr("href");var n=o.substr(0,o.indexOf(";sid=")).concat(o.substr((o.indexOf(";sid=")+41),(o.length-1)));a(this).attr("href",n)})}})(jQuery);